function h = new_hessian(x,b0,s_phi,d_phi,t)
%HESSIAN Summary of this function goes here
%   Detailed explanation goes here
global Mu FN Wf;
% tic;
h = sparse(size(x,1),size(x,1),18*size(x,1)/4);
h(1,1)=d_phi*(1/(2*x(1)*(x(1)^(1/2) + b0^(1/2))^3) + 1/(4*x(1)^(3/2)*(x(1)^(1/2) + b0^(1/2))^2))+1/(x(1)^2*t);
h(3,3)=(4*x(3)^2)/(t*(x(3)^2 + x(4)^2 - (Mu*FN)^2)^2) - 2/(t*(x(3)^2 - (Wf*Mu*FN)^2)) - 2/(t*(x(3)^2 + x(4)^2 - (Mu*FN)^2)) + (4*x(3)^2)/(t*(x(3)^2 - (Wf*Mu*FN)^2)^2);
h(4,4)=(4*x(4)^2)/(t*(x(3)^2 + x(4)^2 - (Mu*FN)^2)^2) - 2/(t*(x(3)^2 + x(4)^2 - (Mu*FN)^2));
h(3,4)=(4*x(3)*x(4))/(t*(x(3)^2 + x(4)^2 - (Mu*FN)^2)^2);
h(4,3)=h(3,4);
h(1,5)=d_phi*(1/(2*x(1)^(1/2)*x(5)^(1/2)*(x(1)^(1/2) + x(5)^(1/2))^3));
h(5,1)=h(1,5);
for k=2:size(x)/4-1
    h((k-1)*4+1,(k-1)*4+1)=d_phi*(1/(2*(x((k-1)*4+1))*((x((k-1)*4+1))^(1/2) + (x((k-1)*4+5))^(1/2))^3) + 1/(4*(x((k-1)*4+1))^(3/2)*((x((k-1)*4+1))^(1/2) + (x((k-1)*4+5))^(1/2))^2) + 1/(2*(x((k-1)*4+1))*((x((k-1)*4+1))^(1/2) + (x((k-1)*4-3))^(1/2))^3) + 1/(4*(x((k-1)*4+1))^(3/2)*((x((k-1)*4+1))^(1/2) + (x((k-1)*4-3))^(1/2))^2))+1/((x((k-1)*4-3))^2*t);
    h((k-1)*4+3,(k-1)*4+3)=(4*(x((k-1)*4+3))^2)/(t*((x((k-1)*4+3))^2 + (x((k-1)*4+4))^2 - (Mu*FN)^2)^2) - 2/(t*((x((k-1)*4+3))^2 - (Wf*Mu*FN)^2)) - 2/(t*((x((k-1)*4+3))^2 + (x((k-1)*4+4))^2 - (Mu*FN)^2)) + (4*(x((k-1)*4+3))^2)/(t*((x((k-1)*4+3))^2 - (Wf*Mu*FN)^2)^2);
    h((k-1)*4+4,(k-1)*4+4)=(4*(x((k-1)*4+4))^2)/(t*((x((k-1)*4+3))^2 + (x((k-1)*4+4))^2 - (Mu*FN)^2)^2) - 2/(t*((x((k-1)*4+3))^2 + (x((k-1)*4+4))^2 - (Mu*FN)^2));
    h((k-1)*4+3,(k-1)*4+4)=(4*(x((k-1)*4+3))*(x((k-1)*4+4)))/(t*((x((k-1)*4+3))^2 + (x((k-1)*4+4))^2 - (Mu*FN)^2)^2);
    h((k-1)*4+4,(k-1)*4+3)=h((k-1)*4+3,(k-1)*4+4);
    h((k-1)*4+5,(k-1)*4+1)=d_phi*(1/(2*(x((k-1)*4+1))^(1/2)*(x((k-1)*4+5))^(1/2)*((x((k-1)*4+1))^(1/2) + (x((k-1)*4+5))^(1/2))^3));
    h((k-1)*4+1,(k-1)*4+5)=h((k-1)*4+5,(k-1)*4+1);
end
h(end-3,end-3)=d_phi*(1/(2*x(end-3)*(x(end-3)^(1/2) + x(end-7)^(1/2))^3) + 1/(4*x(end-3)^(3/2)*(x(end-3)^(1/2) + x(end-7)^(1/2))^2))+1/(x(end-3)^2*t);
h(end-1,end-1)=(4*x(end-1)^2)/(t*(x(end-1)^2 + x(end)^2 - (Mu*FN)^2)^2) - 2/(t*(x(end-1)^2 - (Wf*Mu*FN)^2)) - 2/(t*(x(end-1)^2 + x(end)^2 - (Mu*FN)^2)) + (4*x(end-1)^2)/(t*(x(end-1)^2 - (Wf*Mu*FN)^2)^2);
h(end,end)=(4*x(end)^2)/(t*(x(end-1)^2 + x(end)^2 - (Mu*FN)^2)^2) - 2/(t*(x(end-1)^2 + x(end)^2 - (Mu*FN)^2));
h(end-1,end)=(4*x(end-1)*x(end))/(t*(x(end-1)^2 + x(end)^2 - (Mu*FN)^2)^2);
h(end,end-1)=h(end-1,end);
% toc;
end